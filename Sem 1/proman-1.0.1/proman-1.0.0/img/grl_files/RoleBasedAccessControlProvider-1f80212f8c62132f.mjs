(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[39395],{869899:(e,i,s)=>{s.r(i),s.d(i,{RoleBasedAccessControlProvider:()=>h,useRoleBasedAccessControlContext:()=>A});var r=s(667294),a=s(389643),l=s(784590),t=s(19121),o=s(773285),n=s(425288),c=s(70061);const u=e=>{const i={};for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&("object"!=typeof e[s]||null===e[s]||Array.isArray(e[s])?i[(0,c.Z)(s)]=e[s]:i[(0,c.Z)(s)]=u(e[s]));return i},d=(e,i)=>{const s=[];for(const l in e)l!==i&&s.push({id:l,...u(e[l])});const r=s.sort((({user:{businessName:e}},{user:{businessName:i}})=>e.localeCompare(i))),a=new Map;for(const l of r)a.set(l.id,l);return a};var f=s(622096);const b={profiles:new Map,headerVisible:!1,orbacVisibility:!1,activeProfile:void 0,disableProfileChanger:!1},p=(e,i)=>{switch(i.type){case"LOAD_PROFILES":return{...e,profiles:i.payload};case"SET_ACTIVE_PROFILE":return{...e,activeProfile:i.payload};case"TOGGLE_HEADER_VISIBILITY":return{...e,headerVisible:i.payload};case"TOGGLE_ORBAC_VISIBILITY":return{...e,orbacVisibility:i.payload};case"TOGGLE_DISABLE_PROFILE_CHANGER":return{...e,disableProfileChanger:i.payload};default:return e}},_=e=>{const[i,s]=(0,r.useReducer)(p,b),a=(({dispatch:e,isEnabled:i,state:s})=>{const{orbacVisibility:a,disableProfileChanger:l,headerVisible:t}=s;return{changeProfile:(0,r.useCallback)((s=>{i&&e({type:"SET_ACTIVE_PROFILE",payload:s})}),[i,e]),toggleORBACVisibility:(0,r.useCallback)((s=>{i&&e({type:"TOGGLE_ORBAC_VISIBILITY",payload:null!=s?s:!a})}),[i,e,a]),toggleDisableProfileChanger:(0,r.useCallback)((s=>{i&&e({type:"TOGGLE_DISABLE_PROFILE_CHANGER",payload:null!=s?s:!l})}),[i,e,l]),toggleHeaderVisibility:(0,r.useCallback)((s=>{i&&e({type:"TOGGLE_HEADER_VISIBILITY",payload:null!=s?s:!t})}),[i,e,t])}})({dispatch:s,isEnabled:e,state:i}),{activeProfile:l,orbacVisibility:t}=i;(0,r.useEffect)((()=>{const e=(0,f.qn)("orbacActiveProfile",!1);e&&s({type:"SET_ACTIVE_PROFILE",payload:e})}),[]),(0,r.useEffect)((()=>{const e=(0,f.qn)("orbacVisibilty",!1);e&&s({type:"TOGGLE_ORBAC_VISIBILITY",payload:e})}),[]),(0,r.useEffect)((()=>{(0,f.Nh)("orbacVisibility",t)}),[t]),(0,r.useEffect)((()=>{(0,f.Nh)("orbacActiveProfile",l)}),[l]);return{state:i,actions:a,receiveProfiles:(0,r.useCallback)(((e,i)=>{s({type:"LOAD_PROFILES",payload:d(e,i)})}),[s])}};var E=s(785893);const{Provider:y,useMaybeHook:A}=(0,n.Z)("RoleBasedAccessControlContext"),h=({children:e})=>{const{checkExperiment:i}=(0,o.F)(),s=(0,t.Z)(),n=Boolean(s.isAuth&&s.isPartner&&i("web_m10n_business_access_orbac_www").anyEnabled),{state:c,actions:u,receiveProfiles:d}=_(n),{activeProfile:f,headerVisible:b,profiles:p=[]}=c,A=p?Array.from(p.values()):[],h=(0,a.Z)(A),g=!!(s.isAuth&&A.length>0)&&h,I=s.isAuth?s.id:"",v=s.isAuth?s.username:"",{changeProfile:C,toggleORBACVisibility:L,toggleDisableProfileChanger:P,toggleHeaderVisibility:O}=u;(0,r.useEffect)((()=>{n&&("string"!=typeof h?f||C(I):C(h))}),[h,I,n,C,f]),(0,r.useEffect)((()=>{n&&(g&&!b&&O(!0),!g&&b&&O(!1))}),[O,g,n,b,p]);const{data:m}=(0,l.Z)(n?{name:"ApiResource",options:{url:"/vx/business_access/profiles/",disable_auth_failure_redirect:!0}}:null),R=null==m?void 0:m.profiles;let V;s&&s.isAuth&&c.activeProfile===s.id?V={id:s.id,permissions:["OWNER"],user:{username:v,businessName:s.fullName,imgUrl:s.imageSmallUrl}}:f&&c.profiles&&(V=c.profiles.get(f)),(0,r.useEffect)((()=>{R&&d(R,I)}),[d,R,I]);const B=c.profiles?Array.from(c.profiles.values()):[];return(0,E.jsx)(y,{value:{profiles:B,headerVisible:c.headerVisible,activeProfile:V,changeProfile:C,toggleORBACVisibility:L,toggleDisableProfileChanger:P,toggleHeaderVisibility:O},children:e})}},389643:(e,i,s)=>{s.d(i,{Z:()=>n});var r=s(702664),a=s(19121),l=s(773285),t=s(53987),o=s(276775);const n=e=>{var i;const s=(0,o.useLocation)(),n=(0,a.Z)(),{anyEnabled:c}=(0,l.F)().checkExperiment("web_m10n_business_access_orbac_www"),u=(0,o.useRouteMatch)("/:username"),d=null==u||null===(i=u.params)||void 0===i?void 0:i.username,f=(0,o.useRouteMatch)("/pin/:id"),b=(0,r.useSelector)((e=>{var i,s,r,a;return!(null==f||null===(i=f.params)||void 0===i||!i.id)&&(null==e||null===(s=e.pins)||void 0===s||null===(r=s[f.params.id])||void 0===r||null===(a=r.pinner)||void 0===a?void 0:a.id)}));if((0,t.ej)(s))return!1;if((0,t.RU)(s))return!0;if((0,t.mY)(s))return c;const p=e.concat(n.isAuth?{user:{username:n.username},id:n.id}:{}).find((e=>{const{user:i={},id:s}=e||{},{username:r}=i;return!!(r&&d||b&&s)&&(r===d||b===s)}));return!!p&&p.id}}}]);
//# sourceMappingURL=https://sm.pinimg.com/webapp/RoleBasedAccessControlProvider-1f80212f8c62132f.mjs.map